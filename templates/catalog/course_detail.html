{% extends "base_generic.html" %}

{% block content %}

{% if exists %}
	<h1> {{ subject_code }} {{ catalog_code }}</h1>
	<h3><a href="{{course.subject.getAbsoluteUrl}}">{{ course.subject.name }}</a> - {{ course.name }}</h3>
	
	{% if term_list_items %}
		<div>
		<input type="checkbox" id="showOfferedCheck" onclick="updateShowOffered()"> 
		<label for="showOfferedCheck">Show only terms where {{ subject_code }} {{ catalog_code }} was offered<br/><br/></label></div>
		<div>
		<table id="termTable">
			<tr>
				<th>Term</th>
				<th></th>
				<th>Status</th>
				{% for type in section_types %}<th>{{type}}</th>{% endfor %}
				<th>Instructors</th>
			</tr>	
				
			{% for term, info in term_list_items %}
				{% if info %}


				<tr class="js_toggle_box_unchecked" onclick="updateToggleBox(this)">

					<td>{{term}}</td>
					<td class="nowrap">{{term.reverseName}}</td>
					<td class="nowrap">{{info.status}}</td>
					
					{% for i in info.enrollment %}
					<td>
							<div class="tooltip">
							{{i.enrollmentTotal}}/{{i.enrollmentMax}}<br/>
								<div class="tooltiptext nowrap">
									Sections: {{i.sectionCount}}<br/>
									Average Size: {{i.avgSize}}<br/>
									
									{% for sec in i.sections %}
									<br/>{{ sec.name }}: {% if sec.isCancelled %}Cancelled {% else %} {{sec.total}}/{{sec.max}} {% endif %} 
									{% endfor %}
									</div>
								</div>
					</td>
					{% endfor %}
					
					<td>
						{% if info.instructors %}
						
						{% comment %}
						<input type="checkbox" class="toggle_box" id="{{term}}_toggle_box"/>
						<label for="{{term}}_toggle_box">
							+
							<div>
							{% for inst in info.instructors %}
							<br/><a href="{{ inst.getAbsoluteUrl }}">{{ inst }}</a>
							{% endfor %}
							</div>
						</label>
						{% endcomment %}
						{% for inst in info.instructors %}
						<a href="{{ inst.getAbsoluteUrl }}">{{ inst }}</a> &nbsp;
						{% endfor %}
						
						{% else %}
						Unknown
						{% endif %}
					</td>
				</tr>

				{% else %}
				<tr style="color:grey;" class="offeredUnknown">
					<td>{{ term.code }}</td>
					<td>{{ term.reverseName }}</td>
					<td>Unknown</td>
					<td></td>
				</tr>
				
				{% endif %}
			{% endfor %}
			
			
			{% comment %}
			{% for offering in offering_list %}
				<tr><td>{{ offering.term.name }}</td></tr>
			{% endfor %}
			
			{% endcomment %}
		</table>
		</div>
		<script>
			function updateShowOffered() {
				showOfferedCheck = document.getElementById("showOfferedCheck")
				onlyShowOffered = showOfferedCheck.checked
				
				table = document.getElementById("termTable")
				
				for (var i = 0, row; row = table.rows[i]; i++) {

					if (row.className == "offeredUnknown") {

						if (onlyShowOffered == true) {
							console.log("Filtering row, offeredUnkonwn = true, hiding row")

							row.style.display = "none"
						} else {
							console.log("Filtering row, offeredUnkonwn = true, showing row")
							row.style.display = ""
						}
					} else {
						console.log("Filtering row, offeredUnkonwn = false")

					
					}
				}
				
				
			}
			
			document.getElementById("showOfferedCheck").checked = true
			updateShowOffered()
		</script>

	{% else %}
		<p>There is no record of this course being offered.</p>
	{% endif %}
{% else %}
	Course with code '{{ subject_code }} {{ catalog_code }}' not found.
{% endif %}
{% endblock %}